<%= render 'layouts/top_content' %>
<div class="row">
  <div class="col-md-12">
    <div class="box">
      <div class="box-header with-border">
        <h3 class="box-title">Users Report</h3>
      </div>
      <div class="box-body">
        <div class="col-md-8">
          <%= form_for :users_report, url: users_report_home_index_path, html: {remote: true, autocomplete: 'off'} do |f| %>
              <div class="row">
                <div class="col-md-12">
                  <div class=" text-center">
                    <div class="form-group">
                      <div class="col-sm-4">
                        <%= f.text_field :from, class: 'form-control datepicker', placeholder: 'from' %>
                      </div>
                      <div class="col-sm-4">
                        <%= f.text_field :to, class: 'form-control datepicker', placeholder: 'to' %>
                      </div>
                    </div>
                    <%= f.submit 'search', class: ' pull-left btn btn-md btn-primary' %>
                  </div>
                </div>
              </div>
          <% end %>
          <div class="row">
            <div class="col-md-12">
              <div class="chart">
                <!-- Sales Chart Canvas -->
                <canvas id="usersChart" style="height: 200px; width: 462px;" width="462" height="200"></canvas>
              </div>
              <!-- /.chart-responsive -->
            </div>

          </div>
        </div>
        <div class="col-md-4">
          <h4 class="row text-center">
            Recent Users
          </h4>
          <table class="table table-bordered table-hover">
            <thead>
              <th>Name</th>
              <th>Skilled?</th>
            </thead>
            <tbody>
            <% @recent_users.each do |user| %>
                <tr data-link="<%= user_path(user) %>">
                  <td><%= user.fullname %></td>
                  <td><%= user.is_skilled? %></td>
                </tr>
            <% end %>
            </tbody>
          </table>
        </div>

        <!-- /.row -->
      </div>
      <!-- ./box-body -->
    </div>
    <!-- /.box -->
  </div>
  <!-- /.col -->
</div>


<!-- POSTS BOX -->
<!--<div class="row">-->
<!--<div class="col-md-12">-->
<!--<div class="box">-->
<!--<div class="box-header with-border">-->
<!--<h3 class="box-title">Posts Report</h3>-->
<!--</div>-->
<!--<div class="box-body">-->
<!--<div class="col-md-8">-->
<!--<%#= form_for :posts_report, url: posts_report_home_index_path, html: {remote: true, autocomplete: 'off'} do |f| %>-->
<!--<div class="row">-->
<!--<div class="col-md-12">-->
<!--<div class=" text-center">-->
<!--<div class="form-group">-->
<!--<div class="col-sm-4">-->
<!--<%#= f.text_field :from, class: 'form-control datepicker', placeholder: 'from' %>-->
<!--</div>-->
<!--<div class="col-sm-4">-->
<!--<%#= f.text_field :to, class: 'form-control datepicker', placeholder: 'to' %>-->
<!--</div>-->
<!--</div>-->
<!--<%#= f.submit 'search', class: ' pull-left btn btn-md btn-primary' %>-->
<!--</div>-->
<!--</div>-->
<!--</div>-->
<!--<%# end %>-->
<!--<div class="row">-->
<!--<div class="col-md-12">-->
<!--<div class="chart">-->
<!--&lt;!&ndash; Sales Chart Canvas &ndash;&gt;-->
<!--<canvas id="postsChart" style="height: 200px; width: 462px;" width="462" height="200"></canvas>-->
<!--</div>-->
<!--&lt;!&ndash; /.chart-responsive &ndash;&gt;-->
<!--</div>-->

<!--</div>-->
<!--</div>-->
<!--<div class="col-md-4">-->
<!--<div class="row">-->
<!--</div>-->
<!--<table class="table table-bordered table-hover">-->
<!--<thead>-->
<!--<th>No</th>-->
<!--<th>Description</th>-->
<!--<th>Posted By</th>-->
<!--</thead>-->
<!--<tbody>-->
<!--<%# @recent_posts.each do |post| %>-->
<!--<tr>-->
<!--<td><%#= post.id %></td>-->
<!--<td><%#= post.description.truncate_words(3) %></td>-->
<!--<td><%#= post.user&.fullname %></td>-->
<!--</tr>-->
<!--<%# end %>-->
<!--</tbody>-->
<!--</table>-->
<!--</div>-->

<!--&lt;!&ndash; /.row &ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash; ./box-body &ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash; /.box &ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash; /.col &ndash;&gt;-->
<!--</div>-->

<!--&lt;!&ndash; SERVICE BOX &ndash;&gt;-->
<!--<div class="row">-->
<!--<div class="col-md-12">-->
<!--<div class="box">-->
<!--<div class="box-header with-border">-->
<!--<h3 class="box-title">Top Services Report</h3>-->
<!--</div>-->
<!--<div class="box-body">-->
<!--<div class="col-md-8">-->
<!--<%#= form_for :services_report, url: services_report_home_index_path, html: {remote: true, autocomplete: 'off'} do |f| %>-->
<!--<div class="row">-->
<!--<div class="col-md-12">-->
<!--<div class=" text-center">-->
<!--<div class="form-group">-->
<!--<div class="col-sm-4">-->
<!--<%#= f.select :top_services, [1,3,5,10], {selected: @top_services}, class: 'select2 form-control' %>-->
<!--</div>-->
<!--</div>-->
<!--<%#= f.submit 'search', class: ' pull-left btn btn-md btn-primary' %>-->
<!--</div>-->
<!--</div>-->
<!--</div>-->
<!--<%# end %>-->
<!--<div class="row">-->
<!--<div class="col-md-12">-->
<!--<div class="chart">-->
<!--&lt;!&ndash; Sales Chart Canvas &ndash;&gt;-->
<!--<canvas id="servicesChart" style="height: 200px; width: 462px;" width="462" height="200"></canvas>-->
<!--</div>-->
<!--&lt;!&ndash; /.chart-responsive &ndash;&gt;-->
<!--</div>-->

<!--</div>-->
<!--</div>-->
<!--<div class="col-md-4">-->
<!--<div class="row">-->
<!--</div>-->
<!--<table class="table table-bordered table-hover">-->
<!--<thead>-->
<!--<th>No</th>-->
<!--<th>Description</th>-->
<!--<th>Posted By</th>-->
<!--</thead>-->
<!--<tbody>-->
<!--<%#@recent_services.each do |service| %>-->
<!--<tr>-->
<!--<td><%#= service.id %></td>-->
<!--<td><%#= service.title.truncate_words(3) %></td>-->
<!--<td><%#= service.appointments.count %></td>-->
<!--</tr>-->
<!--<%# end %>-->
<!--</tbody>-->
<!--</table>-->
<!--</div>-->

<!--&lt;!&ndash; /.row &ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash; ./box-body &ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash; /.box &ndash;&gt;-->
<!--</div>-->
<!--&lt;!&ndash; /.col &ndash;&gt;-->
<!--</div>-->



<!-- POSTS BOX -->
<div class="row">
  <div class="col-md-12">
    <div class="box">
      <div class="box-header with-border">
        <h3 class="box-title">Payments Report</h3>
      </div>
      <div class="box-body">
        <div class="col-md-8">
          <%= form_for :posts_report, url: posts_report_home_index_path, html: {remote: true, autocomplete: 'off'} do |f| %>
              <div class="row">
                <div class="col-md-12">
                  <div class=" text-center">
                    <div class="form-group">
                      <div class="col-sm-4">
                        <%= f.text_field :from, class: 'form-control datepicker', placeholder: 'from' %>
                      </div>
                      <div class="col-sm-4">
                        <%= f.text_field :to, class: 'form-control datepicker', placeholder: 'to' %>
                      </div>
                    </div>
                    <%= f.submit 'search', class: ' pull-left btn btn-md btn-primary' %>
                  </div>
                </div>
              </div>
              <% end %>
              <div class="row">
                <div class="col-md-12">
                  <div class="chart">
                    <!-- Sales Chart Canvas -->
                    <canvas id="paymentsChart" style="height: 200px; width: 462px;" width="462" height="200"></canvas>
                  </div>
                  <!-- /.chart-responsive -->
                </div>

              </div>
              </div>
              <div class="col-md-4">
                <h4 class="row text-center">
                  Recent Payments
                </h4>
                <table class="table table-bordered table-hover">
                  <thead>
                  <th>Description</th>
                  <th>Posted By</th>
                  </thead>
                  <tbody>
                  <% @recent_posts.each do |post| %>
                      <tr>
                        <td><%= post.description.truncate_words(3) %></td>
                        <td><%= post.user&.fullname %></td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>

              <!-- /.row -->
              </div>
              <!-- ./box-body -->
              </div>
              <!-- /.box -->
              </div>
              <!-- /.col -->
              </div>

<script>
    var ctx2 = document.getElementById('usersChart').getContext('2d');
    var usersChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: <%= raw (Date.parse(@users_from).upto(Date.parse(@users_to))).map{ |date| date.strftime("%b %d") } %>,
            datasets: [{
                label: '# of Registrations',
                data: <%= @user_data %>,
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    ///// POST CHART

//    var post = document.getElementById('postsChart').getContext('2d');
//    var postsChart = new Chart(post, {
//        type: 'line',
//        data: {
//            labels: <%#= raw (Date.parse(@posts_from).upto(Date.parse(@posts_to))).map{ |date| date.strftime("%b %d") } %>,
//            datasets: [{
//                label: '# of Posts',
//                data: <%#= @posts_data %>,
//                backgroundColor: [
//                    'rgba(255, 99, 132, 0.2)'
//                ],
//                borderColor: [
//                    'rgba(255, 99, 132, 1)'
//                ],
//                borderWidth: 1
//            }]
//        },
//        options: {
//            scales: {
//                yAxes: [{
//                    ticks: {
//                        beginAtZero: true
//                    }
//                }]
//            }
//        }
//    });

    ///// SERVICES CHART
//
//    var service = document.getElementById('servicesChart').getContext('2d');
//    colors = <%#= raw @services_data.size.times.map {|a| "%06x" % (rand * 0xffffff)} %>
//    data = {
//        datasets: [{
//            data: <%#= @services_data.values %>,
//            backgroundColor: colors
//        }],
//        labels: <%#= raw @services_data.keys %>
//    };
//    var servicesChart = new Chart(service, {
//        type: 'polarArea',
//        data: data,
//        options: {
//            scales: {
//                yAxes: [{
//                    ticks: {
//                        beginAtZero: true
//                    }
//                }]
//            }
//        }
//    });

    ///// PAYMENTS CHART

    var payment = document.getElementById('paymentsChart').getContext('2d');
    var paymentsChart = new Chart(payment, {
        type: 'line',
        data: {
            labels: <%= raw (Date.today.at_beginning_of_week.upto(Date.today)).map{ |date| date.strftime("%b %d") } %>,
            datasets: [{
                label: 'Payements',
                data: <%= raw (Date.today.at_beginning_of_week.upto(Date.today)).map{ |date| date.day.to_i } %>,
                backgroundColor: [
                    '#3CB1B0'
                ],
                borderColor: [
                    '#3CB1B0'
                ],
                borderWidth: 1,
                fill: false
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });


</script>